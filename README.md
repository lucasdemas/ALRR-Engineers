# ALRR-Engineers Location Finder

## Second Iteration
	* The README has been updated to reflect the changes/additions done for the second iteration of the term project
	* Our group has met wiht our IA to demo this iteration on 12/2/2022

## NOTE For Performing End to End Tests
	* The database should be prepopulated with a test client for this entrypoint (that has a client id of 3 and an unencryped auth token value of 1)
	* The database should also have 3 locations associated to the test client (with location ids 7, 8, 9 where 2 of them are claimed)
	* If this information is not in the database, the end to end tests will fail (please let one of us know and we can fix it)
	
## Note For Authentication
	* We implemented our own RSA decryption scheme for authentication (and provided the public and private key files used for reference)
	* We designed this service in that we provide the client an authentication token and they need to provided us an encrypted version of it to verify their identity

## Note for public deployment
	* Our service is deployed at https://alrr-engineers.herokuapp.com/` and can be accessed through curl/Postman by the entrypoint specified below
	* This service will not be pulbic for longer than a month (aka till the end of 2022) as heroku costs money to have service deployed publically now

## API Entrypoints
	* ___Clients___ (paths beginning with /client)
		* Get `/authenticate`
			* This endpoint will take the provided encrypted authentication token and see if there is any client that it belongs to in the database
			* It will return the id of the client that has a matching auth token to the decrypted version of the provided token
			* Required inputs:
				* `clientAuthToken` String
			* This endpoint will also make sure the authtoken is in proper format
	
	* ___Locations___ (paths beginning with /location)
		* Get `/getAll`
			* This endpoint is used to retireve all of the locations of a client that are stored in the database
			* Will take in the client id and authentication token to see if the token matches the client id provided
			* Required inputs:
				* `clientId` Integer
				* `clientAuthToken` String
			* This endpoint will make sure that the authentication token belongs to the client id
			* Will also make sure there is a client with that id in the database
			* Will also make sure the authentication token is in the database and belongs to the specified client
		
		* Get `/getClaim`
			* This endpoint will return all locations that are either claimed or unclaimed for the specified client
			* Required inputs:
				* `isClaim` String
					* Can either be claimed or unclaimed
					* All other inputs will result in an exception being thrown
				* `clientId` Integer
				* `clientAuthToken` String
			* This endpoint will make sure that the authentication token belongs to the client id
			* Will also make sure there is a client with that id in the database
			* Will also make sure the authentication token is in the database and belongs to the specified client
			
		* Post `/add`
			* This endpoint will take the provided location name, area and cost and create a new location in the database with the information
			* They will be automatically given a location id that is generated by the database
			* Required inputs:
				* `locName` String
				* `locArea` String
				* `locCost` Double
				* `clientId` Integer
				* `clientAuthToken` String
			* This endpoint will also check to ensure that the location name and area are valid and that the locationCost is a positive number
			* Will also make sure there is a client with that id in the database
			* Will also make sure the authentication token is in the database and belongs to the specified client
			* Will also make sure that the authentication token belongs to the client id
			
		* Post `/updateCost`
			* This endpoint is used to update the cost of a specific location
			* This will check to make sure that the updated cost is also a positive number and throw an exception otherwise
			* This will also check that there is an location with the provided location id in the database and throw an exception if it does not exist
			* This will also check that the location that is being modified belongs to the client attempting to modify it
			* Required inputs:
				* `locId` Integer
				* `locCost` Double
				* `clientId` Integer
				* `clientAuthToken` String
			* Will also make sure there is a client with that id in the database
			* Will also make sure the authentication token is in the database and belongs to the specified client
			* Will also make sure that the authentication token belongs to the client id
				
		* Post `/updateClaim`
			* This endpoint is used to update the claim status of a specific location
			* This will check to make sure that the claim status provided is a boolean value (true or false) and throw an exception otherwise
			* This will also check that there is an location with the provided location id in the database and if it doesn't exist will throw an exception
			* This will also check that the location that is being modified belongs to the client attempting to modify it
			* Required inputs:
				* `locId` Integer
				* `locClaim` Boolean
				* `clientId` Integer
				* `clientAuthToken` String
			* Will also make sure there is a client with that id in the database
			* Will also make sure the authentication token is in the database and belongs to the specified client
			* Will also make sure that the authentication token belongs to the client id
				
		* Post `/delete`
			* This endpoint will delete a location from the database if there is a location that exists with the id provided
			* This will check if a location does exist with the provided id and if not, it will throw an exception
			* This will also check that the location that is being deleted belongs to the client attempting to delete it
			* Required input:
				* `locId` Integer
				* `clientId` Integer
				* `clientAuthToken` String
			* Will also make sure there is a client with that id in the database
			* Will also make sure the authentication token is in the database and belongs to the specified client
			* Will also make sure that the authentication token belongs to the client id
				
				
## Starting the Application
Go to the LocationFinder folder (/LocationFinder) and run the following command:
	`mvnw spring-boot:run` or `./mvnw spring-boot:run` (some team members needed to run the left for it to work and others had to run the right)
	* mvnw will install the most recent maven version so you do not need to install it yourself
	
	* After running this you can use another command terminal to do systems tests by running curl commands (like mentioned in the endpoints)

## Testing the Application
Go to the LocationFinder folder (/LocationFinder) and run the following command:
	`mvnw test` or `./mvnw test` (some team members needed to run the left for it to work and others had to run the right)
	
	* Running this will run all of the tests in the test folder and output the results of the tests
	
## Style Checking, Bug finding and Branch Coverage
For this assignment we used checkstyle to clean up the code and take care of any issues
For the bug finding we used spotbugs to take care of any bugs in our code
For the branch coverage we used jacoco (and achieved branch coverage over 85%)

We get an output of the style erros and bug finding by running the following command in the LocationFinder folder:
	`mvnw site` or `./mvnw site` (some team members needed to run the left for it to work and others had to run the right)
	
This generates a checkstyle html file in the LocationFinder/target/site folder that displays all of the style errors that are present
This generates a spotbugs html file in the LocationFinder/target/site folder that displays all of the bugs that are present
This generates a index html file in the LocationFinder/target/site/jacoco folder that displays the branch coverage report

These files were moved into folders (Branch_Coverage_Report, BugFinder_Spotbugs and StyleChecking_Second_Iteration) at the root level for easier access and visualization

We have incorporated a checkstyle-supress.xml file to supress certain checks that had no effect on the execution of the code (for example removing the need to have a package-info file in each directory) 

## Resources we found helpful for the Project
	* The FantasyBasketball repo example linked to on courseworks: https://github.com/Daktor99/FantasyBasketball/tree/78b84ed691740bc4597622fee79319fa4aec8dcf
	* Learning how to link a spring application to a mysql database: https://spring.io/guides/gs/accessing-data-mysql/
	* How to create a mysql database on AWS: https://aws.amazon.com/getting-started/hands-on/create-mysql-db/
	* How to test for when exceptions are to be thrown in test cases: https://www.codejava.net/testing/junit-test-exception-examples-how-to-assert-an-exception-is-thrown
	* How to supress certain method checks from checkstyle in maven: https://maven.apache.org/plugins/maven-checkstyle-plugin/examples/suppressions-filter.html
	* How to allow client access to service from external url: https://www.baeldung.com/spring-cors
	* Links that helped set up our RSA Encryption and Decryption used for authentication: 
		* https://www.baeldung.com/java-rsa
		* https://www.quickprogrammingtips.com/java/java-asymmetric-encryption-decryption-example-with-rsa.html
	* Link to help deploy our webservice on heroku from sub directory: https://medium.com/@shalandy/deploy-git-subdirectory-to-heroku-ea05e95fce1f
	